<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Creating a Bare Bones OPAC - Systems Librarianship</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Entry level book on systems librarianship.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Systems Librarianship</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cseanburns/systems_librarianship" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="creating-a-bare-bones-opac"><a class="header" href="#creating-a-bare-bones-opac">Creating a Bare Bones OPAC</a></h1>
<p>In this section, we're going to create a bare bones, very basic OPAC.
The idea is simple: to acquire an intuition and understanding of how data
from a relational database is retrieved and entered using LAMP technologies.</p>
<p>A real integrated library system (ILS) is much more complex than what we are doing here, but
the fundamental ideas are the same:
we enter data into a database, and we retrieve data from a database.
In practice, a whole slew of other technologies are added to present the data in a user-friendly way: HTML, CSS, and JavaScript.</p>
<p>ILSes provide modules for patron management, acquisitions, circulation, cataloging,
serials management, authorities, reporting, and sometimes more (see <a href="https://koha-community.org/about/">Koha: About</a>).
Those modules rely on some kind of underlying relational database, like MySQL (which is what Koha uses).
And this results in a complex, interconnected set of tables.
We are working with only one table in our database, the <strong>books</strong> table.
In reality, an ILS will rely on dozens of tables.</p>
<p>In the prior section, we created a MySQL database called <strong>opacdb</strong>, which has one table, called <strong>books</strong>.
We also created a PHP file to retrieve the data from the <strong>books</strong> table and present it on a web page.</p>
<p>In this section, we are going to use different PHP code that will allow us to search the <strong>books</strong> table.
In this way, we more closely mimic an OPAC.</p>
<h2 id="creating-the-html-page-and-a-php-search-page"><a class="header" href="#creating-the-html-page-and-a-php-search-page">Creating the HTML Page and a PHP Search Page</a></h2>
<p>The first thing we do is create a basic HTML page that contains a form for entering queries.
We'll call this HTML page with the form <strong>mylibrary.html</strong>.
When a user clicks on the submit button in the form, the form will activate a PHP script called <strong>search.php</strong>.
That <strong>search.php</strong> will establish a connection to the OPAC database that we already have created.
Our PHP script will contain a special MySQL query that will allow us to search all the fields in our <strong>books</strong> table.
Then it will iterate through each row of the <strong>books</strong> table and return results that match our query.
We also add two date fields to our form to limit results by publication dates,
which we labeled as <strong>copyright</strong> in our MySQL <strong>books</strong> table.</p>
<h3 id="html-form"><a class="header" href="#html-form">HTML Form</a></h3>
<p>Here is the HTML for our search page, titled <strong>mylibrary.html</strong>:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta charset="UTF-8"&gt;
		&lt;title&gt;MySQL Server Example&lt;/title&gt;
	&lt;/head&gt;
&lt;body&gt;

	&lt;h1&gt;A Basic OPAC&lt;/h1&gt;

	&lt;p&gt;In the form below, &lt;b&gt;optionally&lt;/b&gt; enter text in the search field.
	Your search query will search by author, title, or publisher.
	Capitalization is not necessary.
	It's okay to enter partial information, like part of an author's, title's, or publisher's name.&lt;/p&gt;

	&lt;p&gt;You can leave the search field empty and only enter dates.
    Regardless, both start and end dates are required for all searches.
	You can use the date fields to limit results, too.
	I added some extra records, which you can view to know what you can query:&lt;/p&gt;

	&lt;p&gt;&lt;a href="opac.php"&gt;OPAC&lt;/a&gt;&lt;/p&gt;

	&lt;p&gt;This is very much a toy, stripped down
	&lt;a href="https://en.wikipedia.org/wiki/Online_public_access_catalog"&gt;OPAC&lt;/a&gt;.
	The records are basic.
	Not only do they not conform to &lt;a href="https://www.loc.gov/marc/"&gt;MARC&lt;/a&gt;,
	they don't even conform to something as simple as &lt;a href="https://www.dublincore.org/"&gt;Dublin Core&lt;/a&gt;.

	&lt;p&gt;I also don't provide options to select different fields, like author, title, or publisher fields.
	Instead the search field below searches all the fields (author, title, publisher) in our &lt;b&gt;books&lt;/b&gt; table.&lt;/p&gt;

	&lt;p&gt;The key idea is to get a sense of how an OPAC works, though.&lt;/p&gt;

	&lt;h2&gt;My Basic Library OPAC&lt;/h2&gt;

	&lt;form method="post" action="search.php"&gt;
		&lt;label for="search"&gt;Search Terms (optional):&lt;/label&gt;
		&lt;input type="text" name="search" id="search"&gt;
        
		&lt;br&gt;
        
		&lt;label for="start_date"&gt;Start Date:&lt;/label&gt;
		&lt;input type="date" name="start_date" id="start_date" required&gt;
        
		&lt;br&gt;
        
		&lt;label for="end_date"&gt;End Date:&lt;/label&gt;
		&lt;input type="date" name="end_date" id="end_date" required&gt;
        
		&lt;br&gt;
        
		&lt;input type="submit" value="Search"&gt;
	&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="php-search-script"><a class="header" href="#php-search-script">PHP Search Script</a></h3>
<p>Here is the PHP for our search script, which should be named <strong>search.php</strong>:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Search Results&lt;/title&gt;
&lt;style&gt;
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;h1&gt;Search Results&lt;/h1&gt;

    &lt;?php
    // Load MySQL credentials
    require_once '/var/www/login.php';

    // Enable MySQL error reporting
    mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);

    // Establish connection
    $conn = new mysqli($db_hostname, $db_username, $db_password, $db_database);
    if ($conn-&gt;connect_error) {
        die("Connection failed: " . $conn-&gt;connect_error);
    }

    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $search = trim($_POST['search']);
        $start_date = $_POST['start_date'];
        $end_date = $_POST['end_date'];

        // Prepared statement to prevent SQL injection
        $stmt = $conn-&gt;prepare("SELECT * FROM books 
                                WHERE (author LIKE ? OR title LIKE ? OR publisher LIKE ?) 
                                AND copyright BETWEEN ? AND ?");

        // Use wildcard search
        $search_param = "%$search%";
        $stmt-&gt;bind_param("sssss", $search_param, $search_param, $search_param, $start_date, $end_date);
        $stmt-&gt;execute();
        $result = $stmt-&gt;get_result();

        if ($result-&gt;num_rows &gt; 0) {
            echo "&lt;table&gt;";
            echo "&lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Author&lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Publisher&lt;/th&gt;&lt;th&gt;Copyright&lt;/th&gt;&lt;/tr&gt;";

            while ($row = $result-&gt;fetch_assoc()) {
                echo "&lt;tr&gt;";
                echo "&lt;td&gt;" . htmlspecialchars($row["id"]) . "&lt;/td&gt;";
                echo "&lt;td&gt;" . htmlspecialchars($row["author"]) . "&lt;/td&gt;";
                echo "&lt;td&gt;" . htmlspecialchars($row["title"]) . "&lt;/td&gt;";
                echo "&lt;td&gt;" . htmlspecialchars($row["publisher"]) . "&lt;/td&gt;";
                echo "&lt;td&gt;" . htmlspecialchars($row["copyright"]) . "&lt;/td&gt;";
                echo "&lt;/tr&gt;";
            }

            echo "&lt;/table&gt;";
        } else {
            echo "&lt;p&gt;No results found.&lt;/p&gt;";
        }

        $stmt-&gt;close();
    }

    $conn-&gt;close();
    ?&gt;

    &lt;p&gt;&lt;a href="mylibrary.html"&gt;Return to search page&lt;/a&gt;&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="modifications"><a class="header" href="#modifications">Modifications</a></h2>
<p>Add more records, using MySQL, to your <strong>books</strong> table, and test your queries.
To add records to your <strong>books</strong> table, recall that we used the <strong>insert into</strong> MySQL statements.
Here's the example from the prior lesson.
Use it to add titles that are of interest to you.</p>
<p>First connect to the MySQL server:</p>
<pre><code>mysql -u opacuser -p
</code></pre>
<p>Then run the <code>insert</code> command with the data for the new records:</p>
<pre><code>insert into books
(author, title, publisher, copyright) values
('Emma Donoghue', 'Room', 'Little, Brown \&amp; Company', '2010'),
('Zadie Smith', 'White Teeth', 'Hamish Hamilton', '2000');
</code></pre>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>In this lesson, we created a very bare bones OPAC simply to express the fundamental idea
of how data is stored and retrieved on the web.
In reality, what separates an OPAC, or a discovery service in a modern integrated library system
or library service platform, from other databases on the web is the structure of the records
that are stored in the relational database.
Such records are structured using MARC.
Our records are very simply structured, but still, I hope this helps in creating an intuition
about how OPACs and like function.
In the next section, we will learn how to enter data into our catalog,
thereby mimicking the cataloging module of an integrated library system.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="5a-introduction-to-relational-databases.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="5c-basic-opac-admin.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="5a-introduction-to-relational-databases.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="5c-basic-opac-admin.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
